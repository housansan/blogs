Q. 关闭 svr 后, 重新启动 svr.py遇到 Address already in use

## 问题
------------

1. 主动关闭连接, 如何保证对方已经收到全部数据 ?


2. 如果应用层有缓冲, 如何保证先发送缓冲区中的数据然后断开连接 ?


3. 如果主动发起连接, 但是对方拒绝，如何定期(带 back-off)重试 ?


4. 为什么非阻塞编程中, 应用层需要发送缓冲区 ?

	假设应用层需要发送40KB数据, 但是操作系统的TCP发送缓冲区只有25KB剩余空间, 那么剩下的15KB数据怎么办呢? 如果等待OS缓冲区可用那么就会阻塞当前进程，因为不知道**对方什么时候收到并读取数据**，因此网络库应该把这15KB数据缓存起来，放到对应的TCP链接的发送缓存区，等待`socket`变为可写时立刻发送数据，每次有数据需要发送时，都需要追加到缓存队列的尾部,防止打乱数据的顺序

5. 为什么非阻塞编程中，应用层需要接受缓冲区？

	一次读到的数据不是一个完整的数据包，那么这些数据应该缓存起来，等收到一个完整的包后在处理

6. 如何设计缓冲区呢？

	+ 希望减少系统调用, 一次读的数据越多越好，那么应该准备一个大的缓冲区
	
	+ 减少内存占用，如果有10000个并发连接，每个连接都分配50KB的读写缓冲区，将占用1GB，而大多时候这些缓冲区的利用率非常低，毕竟网络情况差比较少

	使用 protocol buffer 的反射机制，每个缓冲区分配固定大小的内存，在需要的时候动态分配，**分配出来的内存需要释放吗**


7. 如何使用发送缓冲去，如果接收方处理缓慢，数据会不会一直堆积在发送方，造成内存暴涨

	+ 固定最大缓冲区大小，超过则认为接收放有问题直接断掉?

8. 如何设计并实现定时器？并使之与网络IO共用一个线程，以避免锁
